workflows:
  react-native-android:
    name: SAQLAIN AI Build (Fixed UI)
    working_directory: . 
    instance_type: mac_mini_m1
    max_build_duration: 60
    environment:
      java: 21
      groups:
        - ai_credentials 
      vars:
        PACKAGE_NAME: "com.saqlainai"
      node: latest
    scripts:
      - name: Setup Environment Variables
        script: |
          printf "KEY1=%s\nKEY2=%s\nKEY3=%s\nKEY4=%s\nKEY5=%s\nKEY6=%s\n" \
          "$KEY1" "$KEY2" "$KEY3" "$KEY4" "$KEY5" "$KEY6" > .env
      - name: Install Dependencies
        script: |
          npm install --legacy-peer-deps
          npm install @capacitor/core @capacitor/cli @capacitor/android
      - name: Build Web Project (Vite)
        script: |
          # This command creates the UI files in the 'dist' folder
          npm run build
      - name: Sync UI to Android (The Black Screen Fix)
        script: |
          # 1. Force Capacitor to use the 'dist' folder generated by Vite
          npx cap init "SAQLAIN AI" "com.saqlainai" --web-dir dist || true
          # 2. Re-create the Android container to ensure fresh assets
          rm -rf android
          npx cap add android
          # 3. Copy the compiled UI files into the Android app
          npx cap copy android
          npx cap sync android
      - name: Build Android Debug APK
        script: |
          export JAVA_HOME=$JAVA_HOME_21
          cd android && ./gradlew assembleDebug
    artifacts:
      - android/app/build/outputs/apk/debug/*.apk
